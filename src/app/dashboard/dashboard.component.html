<div *ngIf="isLoading" id="progress-bar-div">
    <mat-progress-bar id="progress-bar" mode="indeterminate"></mat-progress-bar>
</div>
<div class="container-fluid p-3 my-3 bg-dark text-light">
    <div class="row justify-content-center m-2">
        <div class="col-md-3 text-center">
            <img class="mx-auto" src="assets/images/DataCOP.png" height="40">
            <button mat-raised-button class="actionBtnMap" (click)="centerMap()">
                <fa-icon [icon]="['fas', 'home']"></fa-icon>
            </button>
            <button mat-raised-button class="actionBtnMap" (click)="playTimer()">
                <fa-icon [icon]="['fas', 'play']"></fa-icon>
            </button>
            <button mat-raised-button class="actionBtnMap" (click)="pauseTimer()">
                <fa-icon [icon]="['fas', 'pause']"></fa-icon>
            </button>
            <img class="mx-auto" src="assets/images/DataCOP.png" height="40">
        </div>
        <div class="col-md-3" style="width: 100%;">
            <mat-slider class="yearSlider" [value]="scrollBarValue" (input)="scrollBarChange($event)"
                [(ngModel)]="scrollBarValue" thumbLabel tickInterval="1" min="{{minScrollBarYear}}"
                max="{{maxScrollBarYear}}">
            </mat-slider>
        </div>
        <div class="col-md-3">
            <ng-multiselect-dropdown [placeholder]="statesDropDownListPlaceHolder" [data]="statesDropDownList"
                [(ngModel)]="statesSelected" [settings]="statesDropdownSettings" (onSelect)="onStateSelect()"
                (onDeSelect)="onStateDeselect()">
            </ng-multiselect-dropdown>
        </div>
        <div class="col-md-3">
            <ng-multiselect-dropdown [placeholder]="citiesDropDownListPlaceHolder" [data]="citiesDropDownList"
                [(ngModel)]="citiesSelected" [settings]="citiesDropdownSettings" (onSelect)="onCitySelect()"
                (onDeSelect)="onCityDeselect()">
            </ng-multiselect-dropdown>
        </div>
    </div>

    <div>
        <div class="row card-deck m-2">
            <div *ngFor="let item of _KPI" class="bg-dark text-light card col-md-3 p-2"
                style="border-color: white; border-width: 2px;">
                <div class="text-center" style="font-size: large;">
                    <div class="mb-2">
                        <span id="{{item.title}}">
                            <fa-icon [icon]="['fas', item.icon]"></fa-icon>{{item.title}}:
                        </span>
                    </div>

                    <div class="row">
                        <div class="col-md-6 text-light card KPI" style="border-color: white; border-width: 2px;">
                            <div style="padding-top: 5px;">
                                <div class="mb-2">
                                    Frequency <br>
                                    <small class="text-muted"> {{item.totalCasesUnit}}</small>
                                </div>
                                <span style="font-size: 35px;">
                                    {{item.totalCases}}
                                </span>
                            </div>
                            <div class="text-center mb-1" style="font-size: xx-large;">
                                <span>
                                    <fa-icon *ngIf="item.totalCasesTendency >= 0" [icon]="['fas', 'caret-up']"
                                        style="color: red"></fa-icon>
                                    <fa-icon *ngIf="item.totalCasesTendency < 0" [icon]="['fas', 'caret-down']"
                                        style="color: green;"></fa-icon>
                                    <small style="font-size: large;"> {{item.totalCasesTendency}} %</small>
                                </span>
                            </div>
                        </div>

                        <div class="col-md-6 text-light card KPI" style="border-color: white; border-width: 2px;">
                            <div style="padding-top: 5px;">
                                <div class="mb-2">
                                    {{item.indicatorName}} <br>
                                    <small class="text-muted"> {{item.indicatorUnit}}</small>
                                </div>
                                <span style="font-size: 35px;">
                                    {{item.indicator}}
                                </span>
                            </div>
                            <div class="text-center mb-1" style="font-size: xx-large;">
                                <span>
                                    <fa-icon *ngIf="item.indicatorTendency >= 0" [icon]="['fas', 'caret-up']"
                                        style="color: red"></fa-icon>
                                    <fa-icon *ngIf="item.indicatorTendency < 0" [icon]="['fas', 'caret-down']"
                                        style="color: green;"></fa-icon>
                                    <small style="font-size: large;"> {{item.indicatorTendency}} %</small>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-light card col-md-3 p-2 KPI" style="border-color: white; border-width: 2px;">
                <div class="text-center" style="margin-bottom: 50px; margin-top: 50px;">
                    <span style="height: 100%; font-size: xx-large;">
                        DENG&nbsp;
                        <fa-icon id="dengometer-icon" [icon]="['fas', 'exclamation-circle']"
                            style="font-size: 50px; color: green;"></fa-icon>
                        &nbsp;METER
                    </span>
                </div>
                <small class="text-muted text-right">Possible Outbreak Indicator</small>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-3">
            <h3 class="text-center">TOP CITIES {{scrollBarValue}}</h3>
            <div class="row">
                <div class="col-md-12 mat-elevation-z8">
                    <mat-form-field style="width: 100%;">
                        <mat-label>Filter</mat-label>
                        <input matInput (keyup)="applyFilter($event)" placeholder="Search" #input>
                    </mat-form-field>
                    <table mat-table style="width: 100%;" class="table-dark table-striped" [dataSource]="dataSource" matSort>
                        <ng-container matColumnDef="municipality">
                            <th mat-header-cell *matHeaderCellDef class="text-light" class="text-center"> MUNICIPALITY </th>
                            <td mat-cell *matCellDef="let item" class="text-light"> {{item.municipality}} <small
                                    class="text-right"> ({{item.state}})</small></td>
                        </ng-container>
                        <ng-container matColumnDef="incidence">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-light text-center"> INCIDENCE </th>
                            <td mat-cell *matCellDef="let item" class="text-light text-center"> {{item.incidence}} </td>
                        </ng-container>
                        <ng-container matColumnDef="lethality">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-light text-center"> LETHALITY </th>
                            <td mat-cell *matCellDef="let item" class="text-light text-center"> {{item.lethality}} </td>
                        </ng-container>

                        <ng-container matColumnDef="municipality-description">
                            <th mat-header-cell *matHeaderCellDef>  </th>
                        </ng-container>
                        <ng-container matColumnDef="incidence-description">
                            <th mat-header-cell *matHeaderCellDef class="text-center"> [Cases x 100000 people] </th>
                        </ng-container>
                        <ng-container matColumnDef="lethality-description">
                            <th mat-header-cell *matHeaderCellDef class="text-center"> [%] </th>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns">
                        </tr>
                        <tr mat-header-row *matHeaderRowDef="['municipality-description', 'incidence-description', 'lethality-description']">
                        </tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                    </table>
                    <mat-paginator class="bg-dark text-light" [pageSizeOptions]="[10]"></mat-paginator>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            <div class="p-1">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-correlations-tab" data-toggle="tab"
                            href="#nav-correlations" role="tab" aria-controls="nav-correlations"
                            aria-selected="true">Forecasting</a>
                        <a class="nav-item nav-link" id="nav-timeline-tab" data-toggle="tab" href="#nav-timelineW"
                            role="tab" aria-controls="nav-timeline" aria-selected="false">Timeline (Weekly)</a>
                        <a class="nav-item nav-link" id="nav-timeline-tab" data-toggle="tab" href="#nav-timelineM"
                            role="tab" aria-controls="nav-timeline" aria-selected="false">Timeline (Monthly)</a>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-correlations" role="tabpanel"
                        aria-labelledby="nav-correlations-tab">
                        <div>
                            <canvas baseChart height="700" [datasets]="forecastingData" [options]="forecastingOptions"
                                [legend]="forecastingLegends" [chartType]="forecastingType">
                            </canvas>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-timelineW" role="tabpanel" aria-labelledby="nav-timeline-tab">
                        <div>
                            <canvas baseChart height="700" [datasets]="weeklyData" [labels]="weeklyLabels"
                                [options]="weeklyOptions" [legend]="weeklyLegends" [chartType]="weeklyType">
                            </canvas>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-timelineM" role="tabpanel" aria-labelledby="nav-timeline-tab">
                        <div>
                            <canvas baseChart height="700" [datasets]="monthlyData" [labels]="monthlyLabels"
                                [options]="monthlyOptions" [legend]="monthlyLegends" [chartType]="monthlyType">
                            </canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div>
                <div id='map' style="height: 750px; width: 100%;"></div>
                <div id="controls" class="nicebox">
                    <div id="legend">
                        <div id="census-min">{{minLegendValue}}</div>
                        <div class="color-key"><span id="data-caret">&#x25c6;</span></div>
                        <div id="census-max">{{maxLegendValue}}</div>
                    </div>
                </div>
                <div id="data-box" class="nicebox">
                    <label id="data-label" for="data-value">State</label>
                    <span id="data-value">Value</span>
                </div>
            </div>
        </div>
    </div>
</div>